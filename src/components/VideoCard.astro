---
import type { Talk } from '../lib/types';
import { extractVideoId, getThumbnailUrl } from '../lib/youtube';

interface Props {
  talk: Talk;
}

const { talk } = Astro.props;
const videoId = extractVideoId(talk.url);
const thumbnailUrl = videoId ? getThumbnailUrl(videoId) : '';
---

<article class="group cursor-pointer flex flex-col h-full">
  <a href={`/video/${videoId}`} class="block">
    <div class="relative aspect-video w-full overflow-hidden rounded-md bg-stone-100 dark:bg-stone-800 shadow-classic group-hover:shadow-hover transition-all duration-500 border border-stone-200 dark:border-stone-700/50">
      <img
        alt={talk.title}
        class="h-full w-full object-cover opacity-95 group-hover:opacity-100 group-hover:scale-105 transition-all duration-700 grayscale-[0.1] group-hover:grayscale-0"
        src={thumbnailUrl}
        loading="lazy"
      />
      <!-- Progress bar (will be populated via JS from localStorage) -->
      <div class="progress-container absolute bottom-0 left-0 right-0 h-0.5 bg-black/20 hidden" data-video-id={videoId}>
        <div class="progress-bar h-full bg-red-600/90 w-0"></div>
      </div>
      <!-- Duration (will be populated via JS from localStorage) -->
      <div class="duration-badge absolute bottom-2 right-2 bg-black/70 backdrop-blur-sm px-1.5 py-0.5 rounded text-[10px] font-sans font-medium tracking-wide text-white border border-white/5 hidden" data-video-id={videoId}></div>
    </div>
    <div class="mt-3 flex flex-col flex-1">
      <div class="flex items-start justify-between gap-4">
        <h3 class="text-lg font-serif font-medium leading-snug text-text-primary dark:text-stone-100 group-hover:text-primary dark:group-hover:text-stone-300 transition-colors">{talk.title}</h3>
      </div>
      <div class="mt-1.5 flex items-center gap-2 text-xs text-stone-500 dark:text-stone-400">
        <span class="font-semibold uppercase tracking-wider text-[10px]">{talk.speaker}</span>
        <span class="text-stone-300 dark:text-stone-600">â€¢</span>
        <span class="font-serif italic">{talk.year}</span>
      </div>
      <div class="mt-3 flex flex-wrap gap-1">
        {talk.tags.slice(0, 2).map(tag => (
          <span class="inline-block px-2 py-0.5 rounded border border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800/50 text-[10px] font-sans font-medium text-stone-500 dark:text-stone-400">#{tag}</span>
        ))}
        {talk.tags.length > 2 && (
          <span class="inline-block px-2 py-0.5 rounded border border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800/50 text-[10px] font-sans font-medium text-stone-400 dark:text-stone-500">+{talk.tags.length - 2}</span>
        )}
      </div>
    </div>
  </a>
</article>
